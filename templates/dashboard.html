{% extends "base.html" %}
{% block title %}Главная{% endblock %}

{% block content %}
<h1 class="mb-4">Панель управления</h1>

<div class="row mb-4">
    <div class="col-md-3">
        <div class="card stat-card bg-primary text-white">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-people"></i> Группы</h5>
                <h2>{{ groups }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card bg-success text-white">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-person"></i> Студенты</h5>
                <h2>{{ students }}</h2>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card bg-info text-white">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-file-text"></i> Задания</h5>
                <h2>{{ assignments }}</h2>
                {% if unchecked > 0 %}
                <small>Непроверенных: {{ unchecked }}</small>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card stat-card bg-warning text-white">
            <div class="card-body">
                <h5 class="card-title"><i class="bi bi-book"></i> Занятия</h5>
                <h2>{{ lessons }}</h2>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>Статистика посещаемости</h5>
            </div>
            <div class="card-body">
                <canvas id="attendanceChart"></canvas>
            </div>
        </div>
    </div>
    <div class="col-md-6">
        <div class="card">
            <div class="card-header">
                <h5>Средние оценки по группам</h5>
            </div>
            <div class="card-body">
                <canvas id="scoresChart"></canvas>
            </div>
        </div>
    </div>
</div>

<script>
fetch('/api/analytics/overview')
    .then(r => r.json())
    .then(data => {
        new Chart(document.getElementById('attendanceChart'), {
            type: 'doughnut',
            data: {
                labels: ['Присутствовали', 'Отсутствовали'],
                datasets: [{
                    data: [data.attendance_rate, 100 - data.attendance_rate],
                    backgroundColor: ['#28a745', '#dc3545']
                }]
            }
        });

        document.getElementById('scoresChart').innerHTML = `
            <div class="text-center">
                <h3>${data.average_score}</h3>
                <p>Средний балл за последние 7 дней</p>
            </div>
        `;
    });
</script>
{% endblock %}